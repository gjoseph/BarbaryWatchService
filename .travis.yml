os: osx
language: java

cache:
  directories:
  - $HOME/.m2
  - $HOME/Library/Caches/Homebrew

before_install:
  - brew tap homebrew/cask-versions
  # Homebrew removed java7, so needing to use Azul's Zulu7 build
  # See https://github.com/Homebrew/homebrew-cask-versions/pull/3914
  - brew cask install zulu7
  - /usr/libexec/java_home -V # List installed JDK/JREs
  - export JAVA_HOME=$(/usr/libexec/java_home -v 1.7)
  - java -version
  - ./mvnw -Dhttps.protocols=TLSv1.2 -B -V --settings .travis-settings.xml dependency:go-offline # Pre-download all deps and plugins, so the actual script is less verbose.

jobs:
  include:
    - stage: test
      script: ./mvnw -B -V test
    - stage: deploy
      if: branch = master AND type != pull_request
      script: ./mvnw -Dhttps.protocols=TLSv1.2 -B -V --settings .travis-settings.xml deploy

env:
  global:
    - secure: "Lge5UCp/yESW4pM+wTjIvIKA2+RMH3LeQYCHdUgzvUVojmQ8deJS2JLZ4EdORqT+sMolQCUFuRsneib5OJYA3nxFdrMSLRCnRM0sxI20TJ2KDUuslhIUnB/bXU8saNgF22POjp0wJGOd7fSY09+/z3hnDT/wmey859WFAOJUUuI="
    - secure: "erqbGY3AkJ6qdrPbRtnxJfvTDL77erH3q/idx3s1dHJDuYQBv7nirG1uNSu1exiyBHMUse8MU5OGcIaHoWp5cTNIoH9DD6fKNEhdlgTvqcMOlx4oW/Mc8xO7OU4CjyEKgNAvQjK6bjyz72jX19R22foSTAlns5pHpQtsYfPUowM="
