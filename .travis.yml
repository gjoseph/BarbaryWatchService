os: osx
language: java

cache:
  directories:
  - $HOME/.m2
  - $HOME/Library/Caches/Homebrew

before_install:
  - brew tap homebrew/cask-versions
  - brew cask install java6
  - /usr/libexec/java_home -V # List installed JDK/JREs
  - export JAVA_HOME=$(/usr/libexec/java_home -v 1.6)
  - java -version
  - ./mvnw -B -V --settings .travis-settings.xml dependency:go-offline # Pre-download all deps and plugins, so the actual script is less verbose.

jobs:
  include:
    - stage: test
      script: ./mvnw -B -V test
    - stage: deploy
      # if: branch = master AND type != pull_request
      # go-offline doesn't seem to be completely enough, some deps are still (re-?) downloaded in the build. Can't use --offline, since we deploy
      # 1.6 doesn't have certificates, so we need the 1.8 certs
      script: ./mvnw -B -V --settings .travis-settings.xml -Djavax.net.ssl.trustStore=$(/usr/libexec/java_home -v 1.8)/jre/lib/security/cacerts deploy

env:
  global:
    - secure: "Lge5UCp/yESW4pM+wTjIvIKA2+RMH3LeQYCHdUgzvUVojmQ8deJS2JLZ4EdORqT+sMolQCUFuRsneib5OJYA3nxFdrMSLRCnRM0sxI20TJ2KDUuslhIUnB/bXU8saNgF22POjp0wJGOd7fSY09+/z3hnDT/wmey859WFAOJUUuI="
    - secure: "erqbGY3AkJ6qdrPbRtnxJfvTDL77erH3q/idx3s1dHJDuYQBv7nirG1uNSu1exiyBHMUse8MU5OGcIaHoWp5cTNIoH9DD6fKNEhdlgTvqcMOlx4oW/Mc8xO7OU4CjyEKgNAvQjK6bjyz72jX19R22foSTAlns5pHpQtsYfPUowM="
